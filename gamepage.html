<!DOCTYPE html>

<html lang="en">

    <head>
        <title>HotTake - Game Information</title>
        <link href="styles.css" rel="stylesheet" type="text/css" media="all">
        <link href="app.css" rel="stylesheet" type="text/css" media="all">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://use.typekit.net/nwy3jid.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
        <link rel="manifest" href="assets/favicon/site.webmanifest">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!-- Test Account to use: jeffsu@gmail.com, test123, Chiefs Fan -->
    </head>

    <body>
        <div class="page-body" style="width: 100% !important;">

            <div class="nav-bar" style="margin-top: 0; background-color: black;">
                <a class="back-btn" href="home.html" style="margin-left: 24px;"><img  src="assets/icons/left-arrow.png" alt="Left Arrow"></a>
                <p class="nav-label"></p>
            </div>
                
            <div class="scorecard">
                <div class="scorecard-game-info" style="border-radius: 0; margin-bottom: 0; display: flex; height: 40px;">
                    <div class="live-tag">
                        <p>LIVE</p>
                    </div>
                    <p style="margin: auto;"><span class="game-time"></span><span class="quarter"></span></p>
                </div>
                <div class="scorecard-teams-container">
                    <div class="scorecard-team-card left-team" style="width: 50%; border-radius: 0;">
                        <p style="margin: 4px;"><span class="scorecard-team" id="name-player-team"></span><span class="scorecard-team-record" style="margin-left: 8px;"></span></p>
                        <p class="scorecard-score" id="score-player-team"></p>
                    </div>
                    <div class="scorecard-team-card right-team" style="width: 50%; border-radius: 0;">
                        <p style="margin: 4px;"><span class="scorecard-team-record" style="margin-right: 8px;"></span><span class="scorecard-team" id="name-other-team"></span></p>
                        <p class="scorecard-score" id="score-other-team"></p>
                    </div>
                </div>
            </div>
            
            <div class="loader"></div>

        </div>

        <div class="page-body">
            <br>
            <div class="chat-list-item">
                <img class="team-image" src="" alt="Team Image 1">
                <div style="text-align: center; margin-left: 35px;">
                    <p class="team-name">Team Name</p>
                    <p class="members">People in Chat</p>
                </div>
                <img class="team-image" src="" alt="Team Image 2" style="margin-left: auto;">
            </div>
            <p class="subtitle">Storylines</p>



        </div>

        <script src="tweetjs.js"></script>

        <script src="interactions.js"></script>

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
        <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-analytics.js"></script>
        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-database.js"></script>
        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyC5Hg9BK3TYLPEkEgicBjYnS0zqrJxEUdE",
                authDomain: "hottake-af593.firebaseapp.com",
                databaseURL: "https://hottake-af593.firebaseio.com",
                projectId: "hottake-af593",
                storageBucket: "hottake-af593.appspot.com",
                messagingSenderId: "1022543631385",
                appId: "1:1022543631385:web:90f7d0ae19d193c8ae4688"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);        
        </script>        
    </body>
</html>

<script>
    // Set db
    var db = firebase.firestore();

    var playerTeamAbbreviation = "";
    var teams = ["Minnesota Vikings", "New York Giants", "New England Patriots", "New York Jets"
                , "Arizona Cardinals", "Atlanta Falcons", "Baltimore Ravens", "Buffalo Bills",
                "Carolina Panthers", "Chicago Bears", "Cincinnati Bengals", "Cleveland Browns",
                "Dallas Cowboys", "Denver Broncos", "Detroit Lions", "Green Bay Packers",
                "Houston Texans", "Indianapolis Colts", "Jacksonville Jaguars", "Kansas City Chiefs",
                "Las Vegas Raiders", "Los Angeles Chargers", "Los Angeles Rams", "Miami Dolphins",
                "New Orleans Saints", "Philadelphia Eagles", "Pittsburgh Steelers", "San Francisco 49ers",
                "Seattle Seahawks", "Tampa Bay Buccaneers", "Tennessee Titans", "Washington"];
    var teamsAbbreviated = ["MIN", "NYG", "NE", "NYJ", "ARI", "ATL", "BAL", "BUF", "CAR", "CHI", "CIN", "CLE", 
                            "DAL", "DEN", "DET", "GB", "HOU", "IND", "JAX", "KC", "LV", "LAC", "LA", "MIA", "NO",
                            "PHI", "PIT", "SF", "SEA", "TB", "TEN", "WAS"];
    let teamColors = {
        ARI: ["#97233F", "#FFB612"],
        ATL: ["#A71930", "#000000"],
        BAL: ["#241773", "#9E7C0C"],
        BUF: ["#00338D", "#C60C30"],
        CAR: ["#0085CA", "#101820"],
        CHI: ["#0B162A", "#C83803"],
        CIN: ["#FB4F14", "#000000"],
        CLE: ["#311D00", "#FF3C00"],
        DAL: ["#003594", "FFFFFF"],
        DEN: ["#FB4F14", "#002244"],
        DET: ["#0076B6", "#B0B7BC"],
        GB: ["#203731", "#FFB612"],
        HOU: ["#03202F", "#A71930"],
        IND: ["#002C5F", "#A2AAAD"],
        JAX: ["#006778", "#D7A22A"],
        KC: ["#E31837", "#FFB81C"],
        LAC: ["#FFC20E", "#0080C6"],
        LA: ["#003594", "#FFA300"],
        MIA: ["#008E97", "#FC4C02"],
        MIN: ["#4F2683", "#FFC62F"],
        NE: ["#002244", "#C60C30"],
        NO: ["#D3BC8D", "#101820"],
        NYG: ["#0B2265", "#A71930"],
        NYJ: ["#125740", "#FFFFFF"],
        LV: ["#000000", "#A5ACAF"],
        PHI: ["#004C54", "#A5ACAF"],
        PIT: ["#FFB612", "#101820"],
        SF: ["#AA0000", "#B3995D"],
        SEA: ["#002244", "#69BE28"],
        TB: ["#D50A0A", "#0A0A08"],
        TEN: ["#0C2340", "#4B92DB"],
        WAS: ["#773141", "#FFB612"]
    };

    // Firebase observer
    firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
        var email = user.email;
        console.log(email);
        db.collection("users").doc(email).get().then(function(doc) {
            if (doc.exists) {
                console.log(doc.data().team);
                for (var i = 0; i < teams.length; i++) {
                    if (teams[i] == doc.data().team) {
                        playerTeamAbbreviation = teamsAbbreviated[i];
                        getScore();
                    }
                }
            }
        }).catch(function(error) {
            console.error("Error getting user info: ", error);
        });
    } 
    });

    function getScore() {
        $.ajax({
            type: "GET",
            url: "https://static.nfl.com/liveupdate/scorestrip/ss.xml",
            success: function(results) {
                console.log("Success");
                displayScore(results)
            },
            error: function(error) {
                console.log(error);
            }
        });
    }

    function displayScore(results) {
        resultsList = results.getElementsByTagName("g");
        for (var i = 0; i < resultsList.length; i++) {
            result = resultsList[i];
            console.log(result);
            console.log(result.getAttribute("h"))
            if (result.getAttribute("h") == playerTeamAbbreviation) {
                console.log(result.getAttribute("hs"));
                console.log(result.getAttribute("vs"));
                document.getElementById("score-player-team").innerHTML = result.getAttribute("hs");
                document.getElementById("score-other-team").innerHTML = result.getAttribute("vs");
                document.getElementById("name-player-team").innerHTML = result.getAttribute("h")
                document.getElementById("name-other-team").innerHTML = result.getAttribute("v")
                // Set colors for home team
                document.getElementsByClassName("left-team")[0].style.backgroundColor = teamColors[playerTeamAbbreviation][0];
                document.getElementById("score-player-team").style.color = teamColors[playerTeamAbbreviation][1];
                document.getElementById("name-player-team").style.color = teamColors[playerTeamAbbreviation][1];
                // Set colors for away team
                document.getElementsByClassName("right-team")[0].style.backgroundColor = teamColors[result.getAttribute("v")][0];
                document.getElementById("score-player-team").style.color = teamColors[result.getAttribute("v")][1];
                document.getElementById("name-player-team").style.color = teamColors[result.getAttribute("v")][1];
                document.getElementsByClassName("quarter")[0].innerHTML = result.getAttribute("q");
                document.getElementsByClassName("nav-label")[0].innerHTML = 
                result.getAttribute("h").charAt(0).toUpperCase() + result.getAttribute("h").slice(1) + " at "
                + result.getAttribute("v").charAt(0).toUpperCase() + result.getAttribute("v").slice(1)
                + " - " + result.getAttribute("d") + ", " + result.getAttribute("t");
            } else if (result.getAttribute("v") == playerTeamAbbreviation) {
                console.log(result.getAttribute("hs"));
                console.log(result.getAttribute("vs"));
                document.getElementById("score-player-team").innerHTML = result.getAttribute("vs");
                document.getElementById("score-other-team").innerHTML = result.getAttribute("hs");
                document.getElementById("name-player-team").innerHTML = result.getAttribute("v");
                document.getElementById("name-other-team").innerHTML = result.getAttribute("h");
                // Set colors for home team
                document.getElementsByClassName("left-team")[0].style.backgroundColor = teamColors[result.getAttribute("v")][0];
                document.getElementById("score-player-team").style.color = teamColors[result.getAttribute("v")][1];
                document.getElementById("name-player-team").style.color = teamColors[result.getAttribute("v")][1];
                // Set colors for away team
                document.getElementsByClassName("right-team")[0].style.backgroundColor = teamColors[playerTeamAbbreviation][0];
                document.getElementById("score-player-team").style.color = teamColors[playerTeamAbbreviation][1];
                document.getElementById("name-player-team").style.color = teamColors[playerTeamAbbreviation][1];
                document.getElementsByClassName("quarter")[0].innerHTML = result.getAttribute("q");
                document.getElementsByClassName("nav-label")[0].innerHTML = 
                result.getAttribute("h").charAt(0).toUpperCase() + result.getAttribute("h").slice(1) + " at "
                + result.getAttribute("v").charAt(0).toUpperCase() + result.getAttribute("v").slice(1)
                + " - " + result.getAttribute("d") + ", " + result.getAttribute("t");
            }
            if (result.getAttribute("q") == "1" || result.getAttribute("q") == "2" ||
                result.getAttribute("q") == "3" || result.getAttribute("q") == "4") {
                document.getElementsByClassName("game-time")[0].innerHTML = result.getAttribute("k");
            } else {
                document.getElementsByClassName("live-tag")[0].style.display = "none";
            }
            // Styling for chat button
            document.getElementsByClassName("team-name")[0].innerHTML = result.getAttribute("h") + " at " + result.getAttribute("v");
            document.getElementsByClassName("team-image")[0].src = "assets/team_images/" + teams[teamsAbbreviated.indexOf(result.getAttribute("h"))] + ".png";
            document.getElementsByClassName("team-image")[1].src = "assets/team_images/" + teams[teamsAbbreviated.indexOf(result.getAttribute("v"))] + ".png";
            document.getElementsByClassName("chat-list-item")[0].addEventListener("click", function(event) {
                var teams = result.getAttribute("h") + "_" + result.getAttribute("v");
                setTimeout(() => { location.href= "chatspage.html?Xteam=" + teams.replace(" ", "_"); }, 500);
            }, false);
        }
    }
</script>