<!DOCTYPE html>

<html lang="en">

    <head>
        <title>HotTake - Chats</title>
        <link href="styles.css" rel="stylesheet" type="text/css" media="all">
        <link href="app.css" rel="stylesheet" type="text/css" media="all">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://use.typekit.net/nwy3jid.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
        <link rel="manifest" href="assets/favicon/site.webmanifest">
    </head>

    <body>
        <div class="nav-bar">
            <a class="back-btn" href="home.html"><img  src="assets/icons/left-arrow.png" alt="Left Arrow"></a>
            <p class="nav-label">Log In</p>
        </div>
        <div class="page-body">
            <p class="page-title-large">Chat</p>
            <div class="tab-page">
                <!-- minified snippet to load TalkJS without delaying your page -->
                <script>
                    (function(t,a,l,k,j,s){
                    s=a.createElement('script');s.async=1;s.src="https://cdn.talkjs.com/talk.js";a.head.appendChild(s)
                    ;k=t.Promise;t.Talk={v:3,ready:{then:function(f){if(k)return new k(function(r,e){l.push([f,r,e])});l
                    .push([f])},catch:function(){return k&&new k()},c:l}};})(window,document,[]);
                </script>
                <!-- container element in which TalkJS will display a chat UI -->
                <div id="talkjs-container" style="width: 90%; margin: 30px; height: 500px">
                    <i>Loading chat...</i>
                </div>
            </div>
        </div>

        <script src="tabbar.js"></script>

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
        <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-analytics.js"></script>
        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-database.js"></script>
        <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyC5Hg9BK3TYLPEkEgicBjYnS0zqrJxEUdE",
            authDomain: "hottake-af593.firebaseapp.com",
            databaseURL: "https://hottake-af593.firebaseio.com",
            projectId: "hottake-af593",
            storageBucket: "hottake-af593.appspot.com",
            messagingSenderId: "1022543631385",
            appId: "1:1022543631385:web:90f7d0ae19d193c8ae4688"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);        
        </script>        
    </body>
</html>
<script>
    // Set db
    var db = firebase.firestore();

    // Firebase observer
    firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
        var email = user.email;
        console.log(email);
        db.collection("users").doc(email).get().then(function(doc) {
            if (doc.exists) {
                var userTeam = doc.data().team;
                console.log(userTeam);
                // document.getElementsByClassName("team-name")[0].innerHTML = doc.data().team;
                // document.getElementsByClassName("team-image")[0].src = "assets/team_images/" + doc.data().team + ".png";
                Talk.ready.then(function() {
                    var me = new Talk.User({
                        id: user.email,
                        name: user.email,
                        email: user.email,
                    });
                    window.talkSession = new Talk.Session({
                        appId: "tJDiNf9l",
                        me: me
                    });
                    var other = new Talk.User({
                        id: "654321",
                        name: "Sebastian",
                        email: "Sebastian@example.com",
                        photoUrl: "https://demo.talkjs.com/img/sebastian.jpg",
                        welcomeMessage: "Hey, how can I help?"
                    });
                    var other2 = new Talk.User({
                        id: "Sebastian2",
                        name: "Sebastian2",
                        email: "Sebastian2@example.com",
                        photoUrl: "https://demo.talkjs.com/img/sebastian.jpg",
                        welcomeMessage: "I am  abig fo  big fan of tTom Brayd?"
                    });
                    var conversation = talkSession.getOrCreateConversation(userTeam);
                    conversation.setAttributes({
                        subject: userTeam
                    });
                    conversation.setParticipant(me);
                    conversation.setParticipant(other);
                    conversation.setParticipant(other2);

                    var inbox = talkSession.createInbox({selected: conversation});
                    inbox.mount(document.getElementById("talkjs-container"));
                });
            }
        }).catch(function(error) {
            console.error("Error getting user info: ", error);
        });
    } 
    });
</script>